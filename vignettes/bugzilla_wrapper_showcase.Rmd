---
title: "Bugzilla Wrapper Showcase"
output: 
  html_document:
    toc: true
    number_sections: true
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{Bugzilla Wrapper Showcase}
  %\VignetteEncoding{UTF-8}
---
# Introduction
This notebook explains how to fetch bugs from Bugzilla from bugzilla site by download the bugzilla issues and comments using perceval. We will be using three function which can be found in the R folder.
  ~/kaiaulu/R/download.R: download_bugzilla
  ~/kaiaulu/R/parser.R: parse_bugzilla, parse_bugzillarest

Note: The perceval has two endpoint for bugzilla, so we have two function to parse bugzilla data with different endpoint. One is the traditional backend, and the other one is the REST API backend for Buzilla 5.0 (or higher) servers. The REST API backend will getting more information of issues creator and issue assignee than the traditional backend. For more information, please check: https://github.com/chaoss/grimoirelab-perceval#bugzilla

At the end of the showcase, we will have json object that is downloaded by perceval from bugzilla site, data tables with the bugzilla issues and comments that parse by using traditional perceval or perceval rest.

# Libraries

Please ensure the following R packages are installed on your computer. 

```{r warning = FALSE, message = FALSE}
rm(list = ls())
seed <- 1
set.seed(seed)

require(kaiaulu)
require(stringi)
require(data.table)
require(jsonlite)
```

# Project Configuration File (Parameters Needed)
The parameters necessary for analysis are kept in a project configuration file to ensure reproducibility. In this project, we will using the perceval path which is keep in the  tools.yml in this example to parse the bugzilla data. 

Note: you will need to modify the perceval path in tools.yml to your perceval path, you can find your perceval path by running the following command: 
  Mac and Ubuntu: which perceval
  Windows: where perceval
  
```{r}
tools_path <- "../tools.yml"
tool <- yaml::read_yaml(tools_path)
perceval_path <- tool[["perceval"]]
```

# Download Bugzilla issues and comments using Perceval in traditional Bugzilla backend
As stated in the introduction, we need to download the json object by using perceval from traditional perceval backend. 

The meaning of variables:
  date: date to start bug retrieval
  bugzilla_site: bugzilla site link
  bugzilla_json: json object downloaded from bugzilla site

The bugzilla_json will be use to parse bugzilla data and create data table.

```{r}
date <- "2023-03-05"
bugzilla_site <- "https://bugzilla.redhat.com/"
bugzilla_json <- download_bugzilla(perceval_path, bugzilla_site, date, backend="bugzilla")
```

# Parse Bugzilla data obtained from Perceval traditional Bugzilla backend
Next, we will parse json object we downloaded from the previous step by using parse_bugzilla function.
```{r}
parse_bugzilla(bugzilla_json, comments=FALSE)
```

Here is another result that we will be using the 'parse_bugzilla' function below, along with comments.
```{r}
parse_bugzilla(bugzilla_json, comments=TRUE)
```

# Download Bugzilla issues and comments using Perceval in Perceval REST API Bugzilla backend
Same as download bugzilla data using perceval in trandition bugzilla backend, we will need to download the json object by using perceval from perceval REST API Bugzilla backend.
```{r}
date <- "2023-03-05"
bugzilla_site <- "https://bugzilla.redhat.com/"
bugzilla_rest_json <- download_bugzilla(perceval_path, bugzilla_site, date, backend="bugzillarest")
```

# Parse Bugzilla data obtained from Perceval REST API Bugzilla backend
And we will be using the 'parse_bugzillarest' function below without comments.
```{r}
parse_bugzillarest(bugzilla_rest_json, comments=FALSE)
```

Here is another result that we will be using the 'parse_bugzillarest' function below, along with comments.
```{r}
parse_bugzillarest(bugzilla_rest_json, comments=TRUE)
```
